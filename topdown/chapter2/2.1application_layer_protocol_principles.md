# 2.1应用层协议原理

> 1. 研发网络应用程序的核心时写出能够运行在不同的端系统和通过网络**彼此通信**的*程序*。



### 2.1.1 网络应用程序体系结构

> 1. 当进行软件编码之前，应当对应用程序有一个宽泛的体系结构计划。
> 2. 应用程序体系结构由应用程序研发者设计
> 3. 两种主流的体系结构：**客户 - 服务器体系结构**、**对等(P2P)体系结构**

1. **客户 - 服务器体系结构**

   > 1. 在这种体系结构中，有一个**总是打开**的主机，称为**服务器**
   > 2. 在这种体系结构中，客户相互之间不直接通信。
   > 3. 服务器具有固定的、周知的地址(即IP地址)。因为服务器具有固定的地址，并且服务器总是打开的，所以客户总是能够通过向该服务器的IP地址发送分组来与其练习。
   > 4. 使用该体系结构的著名应用程序由：Web、FTP、Telnet和电子邮件。
   > 5. 如果有大量的请求发送给单独的服务器，那么该服务器将跟不上这些请求。为此，配备大量主机的**数据中心**常被用于创建强大的虚拟服务器。一个数据中心有数十万台服务器。

2. **P2P体系结构**

   > 1. 在**P2P体系结构**中，对于位于**数据中心的专用服务器**有着**最小（或者没有）的依赖**
   > 2. 应用程序在间断连接的主机对之间直接通信，这些主机对被称为**对等方**。
   > 3. 对等方不为服务提供商所有，为用户控制的桌面机和膝上机所有
   > 4. 这种对等方通信**不必通过**专门的**服务器**，该体系结构被称为**对等方到对等方**的。
   > 5. 使用该体系的流量密集型应用有“文件共享(BitTorrent)、对等方协助下载加速器(迅雷)、因特网电话和视频会议。
   > 6. **自扩展性**：在一个P2P文件共享应用中，尽管每个对等方都由于**请求文件产生工作负载**，但每个对等方通过**向其他对等方分发文件**也为系统**增加服务能力**。
   > 7. P2P体系结构通常**不需要**庞大的服务器设施和服务器带宽，但缺面临安全性、性能和可靠性等挑战



****

### 2.1.2 进程通信

> 1. 在多个端系统中的程序间相互通信实质上是**进程**在进行通信，而不是程序
> 2. 本书不特别关注同一台主机上的进程间的通信，而关注运行在不同端系统上的进程的通信。
> 3. 在两个不同端系统上的进程，通过跨越计算机网络交换报文而相互通信。



1. **客户和服务器进程**

   > 1. 网络应用程序由成对的进程组成，这些进程通过网络相互发送报文
   > 2. 每对通信进程，我们通常把两个进程之一标识为**客户**，另一个进程表示为**服务器**。
   > 3. 在一对进程之间的通信会话场景中，发起通信的进程被标识为**客户**，在会话开始时等待联系的进程是**服务器**。

2. **进程与计算机网络之间的接口**

   > 1. 从一个进程向另一个进程发送的报文必须通过下面的网络。
   > 2. 进程通过一个称为**套接字(socket)**的软件接口向网络发送报文和从网络接收报文。
   > 3. 套接字是**同一台主机**内**应用层和运输层**之间的接口。
   > 4. 由于该接口是**建立网络应用程序**的**可编程接口**，因此套接字也称为应用程序和网络之间的**应用程序编程接口(API)**
   > 5. 应用程序开发者可以控制套接字在**应用层端的一切**，但是对该套接字的**运输层端几乎没有控制权**。在运输层的控制权限仅有：I.选择运输层协议 II.也许能设定几个运输层参数。

3. **进程寻址**

   > 1. 在一台主机上运行的进程为了向在另一台主机运行的进程发送分组，接收进程需要有一个**地址**。为了表示该接收进程，需要定义**两种信息**：I.主机的地址 II.在目的主机中指定接收进程的标识符。
   > 2. 在因特网中，主机由其**IP地址标识**。
   > 3. **发送进程**必须**指定**运行在接收主机上的**接收进程**。目的地端口号就用于这个目的。



****

### 2.1.3 可供应用程序使用的运输服务

> 1. 当开发一个应用的时候，必须**选择**一个可用的**运输层协议**。
> 2. 我们从四个方面对应用程序服务要求进行分类：可靠数据传输、吞吐量、定时、安全性

1. **可靠数据传输**

   > 1. 部分应用对数据正确、完全交付给目的主机有严格的要求，为了支持这些应用，必须做一些工作以确保由应用程序的一段发送的数据**正确、完全地**交付给该应用程序的另一端。如果一个协议提供了这样的确保数据交付服务，就认为提供了**可靠数据传输**
   > 2. 当一个运输协议提供这种服务时，发送进程只要将数据传递进套接字，就可以完全相信该数据能**毫无差错**的到达接收进程。
   > 3. 当一个运输层**不提供**可靠数据传输时，由发送进程发送的**某些数据**可能**到达不了接收进程**。可能能被**容忍丢失的应用**(loss-tolerant application)所接收

2. **吞吐量**

   > 1. 由于数据的传输，自然的产生了一种服务，即运输层协议能够以某种特定的速率提供确保的可用吞吐量。
   > 2. 使用这种服务时，应用程序能够请求**r比特/秒**的**确保吞吐量**，**运输协议**能**确保**可用吞吐量总是**至少为r比特/秒。**
   > 3. 具有吞吐量要求的应用程序被称为**带宽敏感的应用**。而**弹性应用**能够根据当时可用的带宽或多或少的利用可供使用的吞吐量。

3. **定时**

   > 1. **运输层协议**也能提供诸如：从发送方注入进套接字中的每个比特到达接收方的套接字**不迟于100ms**等**定时保证服务**。

4. **安全性**

   > 1. 运输协议能为应用程序提供**一种或多种** **安全性服务**。例如，在发送主机中。运输层协议能够加密由发送进程传输的所有数据，在接收主机中，运输层协议能在数据交付给接收进程之前解密这些数据。
   > 2. 除了加密服务，还有例如**数据完整性**和**端点鉴别**等安全性服务



****

### 2.1.4 因特网提供的运输服务

> 1. 因特网为应用程序提供两个运输层协议，即TCP、UDP。每个协议为调用它们的应用程序提供了不同的服务集合。

1. **TCP服务**

   > 1. **TCP服务模型**包括**面向连接服务**和**可靠数据传输服务**。
   >
   >    - 面向连接的服务
   >
   >      > 1. 在应用层数据报文**开始流动之前**，TCP让客户和服务器相互**交换运输层控制信息**(即**握手**)
   >      > 2. 这个握手过程提醒客户和服务器，让它们为大量分组的到来做好准备。
   >      > 3. **握手阶段以后**，一个**TCP连接**就在两个进程的**套接字之间**建立了。
   >      > 4. 这条连接是**全双工**的，即**连接双方的进程**可以在此连接上**同时进行报文收发**。
   >
   >    - 可靠的数据传送服务
   >
   >      > 1. 通信进程可以依靠TCP，**无差错、按适当顺序**交付**所有发送的数据**。
   >      > 2. 当应用程序的一端将字节流传进套接字时，他能够依靠TCP将相同的字节流交付给接收方的套接字，**没有**字节的**丢失和冗余**
   >
   >    - TCP协议还具有**拥塞控制机制**。当发送发和接收方之间的**网络出现拥塞**时，**TCP的拥塞控制机制**会**抑制发送进程**。

2. **UDP服务**

   > 1. UDP是一种**不提供不必要服务**的**轻量级运输协议**，它仅提供**最小服务**。
   > 2. UDP是**无连接的**，因此没有在两个进程通信前的握手过程。
   > 3. UDP提供一种**不可靠数据传送服务**，当一个进程把一个报文发送进UDP套接字时，UDP协议并**不保证**该**报文将到达接收进程**，而且**到达**接收进程的报文**也可能**是**乱序到达**的。
   > 4. UDP**没有拥塞控制机制**，所以UDP的**发送端**可以用它选定的**任何速率**向其**下层(网络层)注入数据**。（然而，由于中间链路的带宽受限或网络拥塞，**实际端到端吞吐量可能小于该速率**）

3. **因特网运输协议所不提供的服务**

   > 1. TCP和UDP没有提供对吞吐量和定时保证的服务，因特网能够为时间敏感应用提供满意的服务，但它**不能提供任何定时或带宽保证**。



****

### 2.1.5 应用层协议

> 1. **应用层协议**定义了运行在不同端系统上的应用程序进程如何相互传递报文，特别定义了：
>    - **交换的报文类型**，如请求报文和相应报文
>    - **各种报文类型的语法**，如报文中的各个字段及这些字段是如何描述的。
>    - **字段的语义**，即这些字段中信息的含义
>    - **确定一个进程何时以及如何发送报文，对报文进行响应的规则**。
> 2. 有些应用层协议是由RFC文档定义的，它们位于公共域中，如HTTP协议。
> 3. 区分网络应用和应用层协议是很重要的。



****

### 2.1.6本书涉及的网络应用

> 1. 本书讨论五种重要的应用：Web，文件传输、电子邮件、目录服务、流式视频、P2P

