# 1.4分组交换网中的时延、丢包和吞吐量

> 吞吐量：每秒能够传送的数据量

### 1.4.1 分组交换网中的时延概述

> 1. 当分组从一个节点（主机或路由器）沿着这条路径到后继节点(主机或路由器)，该分组在沿途的每个节点经受了不同类型的时延。
>
> 2. 这些时延中最为重要的是
>
> - **节点处理时延(nodal processing delay)**		
> - **排队时延(queuing delay)**
> - **传输时延(transmission delay)**
> - **传播时延(propagation delay)**
>
> 3. 这些时延*累加*起来即**节点总时延(total noadl delay)**

1. 时延的**类型**

   - **处理时延**

     > 1. **检查首部**和**决定该分组导向何处**所需要的时间是**处理时延**的一部分。还包括如检查比特级别的差错所需要的时间，该差错出现在从上游节点向路由器传输这些分组比特的过程中。

   - **排队时延**

     > 1. 在队列中，当分组在链路上等待传输时，它经受**排队时延**。
     >
     > 2. 一个特定分组的排队时延长度**取决于**先期到达的正在排队等待向链路传输的分组数量。（排队时延应该还要加上正在传输的分组的传输时延？书上没有说明，但是根据后面这句话来看应该是需要的。）如果该队列是**空**的，并且当前**没有其他分组正在传输**，则该分组的排队时延为0.

   - **传输时延**

     > 1. 假定分组以先到先服务方式传输，仅当所有已经到达的分组被传输以后，才能传输刚到达的分组。
     >
     > 2. 用**L比特**表示该分组的长度，用**Rbps**(b/s)表示路由器A到路由器B的链路传输速率，则
     >
     > $$
     > 传输时延 = L/R
     > $$
  > ​	这是将所有分组的比特推向链路所需要的时间。

- **传播时延**
  
     > 1. 一旦一个比特被推向链路，该比特需要向路由器B传播。从该链路的起点到路由器B传播所需要的时间是**传播时延**。
     >
     > 2. 该比特以该链路的传播速率传播。该传播速率取决于链路的物理媒体。
     >
     > $$
     > 速率范围为：2*10^8 - 3*10^8 m/s
     > $$
     > 3. 传播时延等于两台路由器之间的距离除以传播速率。假设d是路由器之间的距离，v是该链路的传播速率，则有:
     >
  > $$
     > t_{传播时延} = d/v
  > $$
  
   - 传输时延和传播时延的**比较**
  
     > 1. 传输时延是路由器推出分组所需要的时间，它是分组长度和链路传输速率的函数
     >
     > 2. 传播时延是一个比特从一台路由器传输到另一台路由器所需要的时间，他是两台路由器之间距离的函数，而与分组长度或链路传输速率无关
     >
     > 3. 总时延公式：
     >
     > $$
     > d_{nodal} = d_{proc}+d_{queue}+d_{trans}+d_{prop     }
     > $$
     >



****

### 1.4.2 排队时延和丢包

1. **排队时延**

   > 1. *排队时延*很大程度取决于流量**到达该队列的速率**、**链路的传输速率**和**到达流量的性质**，即流量是**周期性**到达还是以**突发**形式到达。
   >
   > 2. 令a表示**分组**(一个分组中由L个比特)到达队列的平均速率(a的单位是**分组/秒**即pkt/s)。
   >
   >    R是传输速率，即队列中推出比特的速率(以bps即b/s为单位)
   >
   >    假设**所有分组都是由L比特组成**，则**比特**到达队列的平均速率为**La bps**。
   >
   >    最后假设该队列**非常大**，它基本能容纳无限数量的比特(只是假设！！！)
   >
   >    则有:
   >
   > $$
   > 流量强度=(La)/R
   > $$
   >
   > 3. 如果流量强度**La/R > 1** ，则**意味着**比特**到达队列的平均速率**超过**从该队列传输出去的速率**（就好比每10s内有5辆汽车到达收费站，但是每10s内收费站只能放行2辆车）。在这种情况下，该队列将趋向于无限增加，排队时延将趋向无穷大。所以设计系统时流量强度不能大于1！
   >
   > - 如果流量强度La/R <=1 。此时到达流量的性质将影响排队时延。
   >   - 如果分组**周期性到达**，即**每L/R秒**到达一个分组，则每个分组将**到达一个空队列**中，不会有排队时延(因为分组交换机处理一个分组的时间即为L/R)
   >   - 如果分组**突发形式到达**，则很可能会有较大的平均排队时延。假如每**(L/R)N**秒同时到达**N**个分组，则传输的**第一个分组没有排队时延**，传输的第二个分组就有L/R秒的排队时延，更一般的，**第n个传输的分组**具有**(n-1)(L/R)**的*排队时延*。
   > - 无论如何，随着流量强度**接近1**，**平均排队长度**将变得越来越长。

2. **丢包**

   > 1. 在现实生活中，一条链路前的队列只能有**有限的容量**。
   >
   > 2. 因为该排队容量是有限的，随着流量强度接近1.排队时延不会真正趋向无穷大，相反，到达的分组将发现一个**满的队列**。由于没有地方存储这个分组，路由器将**丢弃**这个分组，即该分组**丢失**了。
   >
   > 3. 丢失的分组可能会基于**端到端的原则**重传。



****

### 1.4.3 端到端时延

> 1. 假设源主机和目的主机之间有**N-1**台路由器，以及假设网络此时是无拥塞的(即**忽略排队时延**)，则有**端到端时延**：
>
> $$
> d_{end-end} = N(d_{proc}+d_{tans}+d_{prop}) \\
> d_{tans}=L/R \\
> d_{proc} = 处理时延\\
> L=分组长度\\
> R=输出速率
> $$



1. Tracerote

2. **端系统、应用程序和其他时延**

   - 有时，希望向**共享媒体**传输分组的端系统可能**有意的**延迟它的传输，把这作为它和其他端系统共享媒体的**协议的一部分**

   - 媒体分组化时延：这种时延出现在IP语音中。

     > 1. 在VoIP中，发送方在向因特网传递分组之前必须首先用编码的数字化语音填充一个分组。这种填充一个分组的时间称为分组化时延。它可能较大。



****



### 1.4.4 计算机网络中的吞吐量

> 假设主机A向主机B跨越计算机网络发送一个大文件。

1. **瞬时吞吐量**

   - 在任何时刻的瞬间吞吐量是主机B接收到该文件的速率(bps)。

2. **平均吞吐量**

   - 如果该文件由F个比特构成，主机B接收到所有F比特用去T秒，则有：

   $$
   平均吞吐量= F/T (bps)
   $$

> 1. 假设Rs表示服务器与路由器之间的链路速率(传输速率)，Rc表示路由器与客户端的链路速率(传输速率)。
>
> 对于该假设的两链路网络，其**吞吐量**为：
> $$
> 吞吐量=min\{R_c,R_s\}
> $$
> ​	也是**瓶颈链路**的**传输速率**

